# 沿线行走1
&emsp;&emsp;上一节，我们给机器人装上了超声波传感器，机器人终于有了一点意识：感知前方是否有障碍物，并且经过编程机器人可以自动避开障碍行走了。为了让我们的机器人更好的行走，本节我们给机器人准备了属于它的路线，如下图，让它沿着路线行走吧。

![机器人沿线行走](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210331084326.png)

## 一、巡线传感器及其原理
&emsp;&emsp;要想要让机器人感知黑线，我们需要用到位于机器人主板底部的`循迹传感器`。可以发现循迹传感器好像有两个灯，并且中间还有一个挡板。循迹传感器在工作的时候，一个灯点亮发出光线。根据科学知识：不同颜色的物体所吸收的光不同，黑色会吸收大部分的光线，而光线遇到白色物体会反射大部分的光线。这个时候传感器上的另一个灯就可以根据光线反射的多少判断是遇到了黑色物体还是白色物体了。这便是循迹传感器的工作原理。

![循迹传感器原理图](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210331084538.png)

## 二、感知黑白线
&emsp;&emsp;明白了循迹传感器的原理，我们现在来具体看看如果获取循迹传感器返回的数据。在“机器人”的编程指令中，有关于板载和外接循迹传感器的指令。由于OSTD机器人小车已经将循迹传感器集成在了底板上，我们可以直接使用板载传感器指令，板载循迹传感器可以选择传感器的编号1、2、3号，对应于机器人底部的三个循迹传感器。

![OSTD机器人底部循迹示意图](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210331085641.png)

![OSTD板载循迹指令与机器人循迹传感器对应图](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210331085759.png)

&emsp;&emsp;先以中间的循迹2为列，搭建如下获取循迹传感器数据的脚本。仔细观察传感器在黑线和白线上时候的返回值。

![获取板载传感器的测试脚本](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210331090818.png)

**实验观察**：

|                  | 黑色地面 | 白色地面 |
| :--------------: | :------: | :------: |
| 板载传感器返回值 |    1     |    0     |

**Tips**:

* 当你把循迹传感器分别放在黑线、白色上时，可以发现变量中的`板载传感器值`只有两种情况：1或0，而不像上一节中的超声波传感器可以返回连续变化的距离值。这里需要特别说明的是，**板载循迹传感器获取的是一种`数字信号`，开源硬件中把只有两种状态的信号叫做`数字信号`，而像超声波传感器获取的连续变化信号，我们称为`模拟信号`。**

* ![板载传感器指令](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210331092223.png)，我们再看这条指令的形状（扁扁的六边形），在Scratch编程中这是一种逻辑判断指令，如果你双击指令，会返回True（真）或False（假）。其实在**编程语言中（如C语言中）1就表示True（真），0就表示False（假）**。所以我们的实验表格可以再一次完善。

  |                  | 黑色地面 | 白色地面 |
  | :--------------: | :------: | :------: |
  | 板载传感器返回值 |  1/True  | 0/False  |

* `数字信号`虽然只有两种状态，但已经足够表示黑、白两种状态了吧。

**实验结论**：

* 1/Ture：表示的就是黑色；

* 0/False：表示的就是白色。

  在实际编程中，由于指令![板载传感器指令](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210331092223.png)，本身就是一种逻辑判断，我们可以省略变量直接放在`如果`语句中做判断，如下图所示：

  ![如果语句+循迹指令编程图](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210331094027.png)



## 编程任务：单光感巡线
&emsp;&emsp;利用循迹传感器+行走，我们就可以实现机器人沿着黑色路径行走了。现在循迹传感器有3个，其实只用一个循迹传感器就可以实现沿着黑线行走，即`单光感巡线`。这是一种比较简单的情况。请大家先看视频，观察机器人的行走，思考单光感巡线行走时如何实现的。

【视频二维码】

**算法分析**：

* 1.机器人如果中间的2号传感器在黑线上，那么就前进。
* 2.如果机器人的2号传感器不在黑线上，那么就让机器人右转。（只要右转，2号传感器就会到黑线，再前进）

**参考脚本**：

![单光感巡线流程图与参考脚本](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210331094949.png)


## 拓展任务：
&emsp;&emsp;根据循迹传感器的原理，如果把机器人离地面很远，“接收光线的灯”也会收不到反射光线，那么也会返回1/Ture，利用这一现象，我们可以换一种玩法：悬崖勒马，即让机器人在桌子上行走，当遇到“悬崖”自己停下或者换一条路线。可以利用外接的循迹传感器，将检测装置向外延伸，更安全哦！

* **任务1：悬崖勒马**

【视频二维码】

​	**参考脚本**：

![悬崖勒马程序](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210331095935.png)

* **任务2：在桌上安全且自由行走**

  【视频二维码】

  **参考脚本**：

  ![image-20210331100137109](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210331100137.png)

