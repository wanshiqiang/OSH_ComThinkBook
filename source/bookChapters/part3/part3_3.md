# 制作调速风扇

## 项目情景

![项目情景](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210430092110.png)



项目演示

![项目演示二维码](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210430093222.png)

## 活动目标

1. 掌握滑杆传感器的使用方法；
2. 利用滑杆传感器和马达制作调速风扇，掌握将滑杆值比例转换为风扇转速的算法。

## 设备介绍

> 滑杆传感器又称滑动电位器，通常由电阻体和可移动的电刷组成，通过移动滑块得到不同的电阻值。

### 1.硬件连接

![调速风扇的滑杆连接器](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210428121035.png)

### 2.硬件调试

* 滑杆传感器调试

滑杆传感器随着滑杆的移动获取的信号是连续变化的，故我们可以用`读模拟口`的指令来获取滑杆传感器的数据。将读到的模拟口数据放入变量中是常用的调试方法，输入脚本如下图：

![调试滑杆传感器脚本](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210428122917.png)

点击绿旗启动后，滑动滑杆传感器的滑块，观察Scratch舞台中`滑杆值`变量的数据变化可以发现滑杆值的变化范围是`0~1023`。

* 风扇马达速度控制调试

上一节我们在控制风扇转动的时候用的是`设置接口电平`指令的数字输出方式，这种方式只能控制开和关，无法实现马达速度快慢的控制。我们可以通过`设置电机驱动接口1 转速`指令来控制马达的转速，如下图所示。

![image-20210428124432391](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210428124432.png)



## 编程探究

### 1.需求描述

调速功能：根据滑杆传感器的滑块位置改变风扇的转速。

* 滑块从左向右滑动，风扇速度逐渐变快，直到最快。
* 滑块从右向左滑动，风扇速度逐渐变慢，直到停止。

### 2.算法设计

经过前面的研究，我们可以发现滑杆值的范围是：`0~1023`，而风扇的转速控制范围是：`0-255`。如何让滑杆值的变化跟转速的变化一一对应起来呢？其实这是一个数学的比例换算问题。

![比例换算](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210428152853.png)

上面的数学公式含义：**将滑块移动的位置经过运算后转化为对于的实际转速**，在用Scratch脚本表示为：

![实际转速公式](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210428155259.png)

### 3.参考脚本

![参考脚本](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210428155232.png)

## 成果小结

* 信息视角看项目：**从信息视角去理调速风扇程序，即通过滑杆传感器提供从小逐步变大的模拟信号，主板经过一系列运算（比例映射）后转为马达的转速变化，由马达进行动作的输出**。

  ![信息视角看调速风扇项目](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210430084816.png)

* 编程技巧

  * 本节的难点是如何将滑杆值转为速度值，这里用到的是数学上比例的知识，可见数学知识对于编程算法的重要性。
  * **定义新积木**：在今后的项目中如果要用到滑杆传感器，还会涉及到类似的换算问题，我们可以**将这种比例换算的逻辑抽象定义为一个名为`映射`的新积木（函数）**，今后既可以更加灵活的使用了。
  
  ![定义新积木](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210430084849.png)

有了`映射`新积木项目重构为：

![重构后的项目脚本](https://gitee.com/wansq0211/markdownImg/raw/master/img/20210430085220.png)

